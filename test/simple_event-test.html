<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link type="text/css" rel="stylesheet" href="../libs/qunit.css"/>
    <script type="text/javascript" src="../libs/jquery-1.11.0.js"></script>
    <script type="text/javascript" src="../libs/qunit.js"></script>
    <script type="text/javascript" src="../libs/qunit-extras.js"></script>
    <script type="text/javascript">
        /**
         * --Event.subscribe(subscriber)
         * --Event.subscribe(subscriber) more than multi-times
         * Event.unsubscribe(subscriber)
         * --Event.emit(..)
         * Your goal is to write an Event constructor function, which can be used to make event objects.

         An event object should work like this:

         it has a .subscribe() method, which takes a function and stores it as its handler
         it has an .unsubscribe() method, which takes a function and removes it from its handlers
         it has an .emit() method, which takes an arbitrary number of arguments and calls all the stored functions with these arguments
         As this is an elementary example of events, there are some simplifications:

         all functions are called with correct arguments (e.g. only functions will be passed to unsubscribe)
         you should not worry about the order of handlers' execution
         the handlers will not attempt to modify an event object (e.g. add or remove handlers)
         the context of handlers' execution is not important
         each handler will be subscribed at most once at any given moment of time. It can still be unsubscribed and then subscribed again
         Also see an example test fixture for suggested usage
         */
        function Event() {
            var subscribers = [];
            this.subscribe = function (subscriber) {
                this.unsubscribe(subscriber);
                subscribers.push(subscriber);
            };
            this.emit = function () {
                var args = [].slice.call(arguments);
                subscribers.forEach(function (subscriber) {
                    subscriber.apply(null, args);
                });
            };
            this.unsubscribe = function (subscriber) {
                var index = subscribers.indexOf(subscriber);
                if (index == -1) {
                    return;
                }
                subscribers.splice(index, 1);
            };
        }
    </script>
    <script type="text/javascript">
        var event;
        var args;

        function handler() {
            args = [].slice.call(arguments);
        }

        module('Simple Event', {
            setup: function () {
                event = new Event();
                args = null;
                event.subscribe(handler);

            }
        });
        test('emit', function () {
            event.emit();
            ok(args);
        });
        test('subscribe repeat', function () {
            var times = 0;

            function counter() {
                times++;
            }

            event.subscribe(counter);
            event.subscribe(counter);

            event.emit();
            equal(times, 1);
        });
        test('emit with arguments', function () {
            event.emit('a', 'b');
            deepEqual(args, ['a', 'b']);
        });
        test('unsubscribe', function () {
            event.unsubscribe(handler);
            event.emit();
            ok(!args);
        });
        test('unsubscribe unknown handler', function () {
            event.unsubscribe(function unknown() {
            });
            event.emit();
            ok(args);
        });
    </script>
</head>
<body>
<div id="qunit"></div>
</body>
</html>