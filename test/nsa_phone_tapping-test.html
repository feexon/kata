<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link type="text/css" rel="stylesheet" href="../libs/qunit.css"/>
    <script type="text/javascript" src="../libs/jquery-1.11.0.js"></script>
    <script type="text/javascript" src="../libs/qunit.js"></script>
    <script type="text/javascript">
        var NSA = {
            log: function (whom) {
                var records = whom.records.splice(0).map(function (record) {
                    var action = record[2];
                    var callee = record[1];
                    var cellphone = record[0];
                    return whom.name + ' ' + action + 'ed ' + callee.name + ' from ' + cellphone.owner.name + "'s phone(" + cellphone.number + ")";
                });
                return (records.length && records || ['No Entries']).join('\n');
            }
        };
        function Person(name) {
            this.name = name;
            this.records = [];

            this.call = function (cellphone, callee) {
                this.records[0] = [cellphone, callee, 'call'];
            };

            this.text = function (cellphone, callee) {
                this.records.push([cellphone, callee, 'text']);
            };
        }

    </script>
    <script type="text/javascript">
        var dan, anthony, erin;

        module('NSA phone tapping', {
            setup: function () {
                dan = new Person('Dan');
                anthony = new Person('Anthony');
                erin = new Person('Erin');
            }
        });

        test('create Person', function () {
            equal(new Person('Joe').name, 'Joe');
        });

        test("NSA.log(Person) with no entries", function () {
            equal(NSA.log(dan), 'No Entries');
        });

        test("NSA.log(Person) with a call", function () {

            dan.call({owner: dan, number: '202-555-0199'}, anthony);
            equal(NSA.log(dan), "Dan called Anthony from Dan's phone(202-555-0199)");

            anthony.call({owner: anthony, number: '202-555-0149'}, dan);
            equal(NSA.log(anthony), "Anthony called Dan from Anthony's phone(202-555-0149)");
        });

        test("Person.records after log", function () {

            dan.call({owner: dan, number: '202-555-0199'}, anthony);
            equal(dan.records.length, 1);
            NSA.log(dan);
            equal(dan.records.length, 0);

        });

        test("NSA.log(Person) with a call using others phone", function () {

            dan.call({owner: anthony, number: '202-555-0149'}, erin);
            equal(NSA.log(dan), "Dan called Erin from Anthony's phone(202-555-0149)");
        });

        test("NSA.log(Person) with multi calls", function () {
            dan.call({owner: dan, number: '202-555-0199'}, anthony);
            dan.call({owner: dan, number: '202-555-0199'}, erin);
            equal(NSA.log(dan), "Dan called Erin from Dan's phone(202-555-0199)");

        });

        test("NSA.log(Person) with multi texts", function () {
            dan.text({owner: dan, number: '202-555-0199'}, anthony);
            dan.text({owner: dan, number: '202-555-0199'}, erin);
            equal(NSA.log(dan), "Dan texted Anthony from Dan's phone(202-555-0199)\nDan texted Erin from Dan's phone(202-555-0199)");

        });

        test("NSA.log(Person) with text", function () {
            dan.text({owner: dan, number: '202-555-0199'}, anthony);
            equal(NSA.log(dan), "Dan texted Anthony from Dan's phone(202-555-0199)");
        });


        //        test("NSA.log(Person) with calling and text", function () {
        //            dan.call({owner: dan, number: '202-555-0199'}, anthony);
        //            dan.text({owner: dan, number: '202-555-0199'}, anthony);
        //            equal(NSA.log(dan), "Dan called Anthony from Dan's phone(202-555-0199)\nDan texted Anthony from Dan's phone(202-555-0199)");
        //        });
    </script>
</head>
<body>
<div id="qunit"></div>
</body>
</html>