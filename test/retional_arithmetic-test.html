<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link type="text/css" rel="stylesheet" href="../libs/qunit.css"/>
    <script type="text/javascript" src="../libs/jquery-1.11.0.js"></script>
    <script type="text/javascript" src="../libs/qunit.js"></script>
    <script type="text/javascript" src="../libs/qunit-extras.js"></script>
    <script type="text/javascript">
        /**
         *
         */

        function gcd(m, n) {
            if (n == 0) {
                return m;
            }
            return gcd(n, m % n);
        }
        function Retional(numerator, denominator, keep) {
            this.numerator = numerator;
            this.denominator = denominator;
            this.simplify = function () {
                var m = gcd(this.numerator, this.denominator);
                this.numerator /= m;
                this.denominator /= m;
            };
            function spec(comparator) {
                return function (other) {
                    return eval('this.reduce(other) ' + comparator + ' other.reduce(this)');
                }
            }

            this.reduce = function (other) {
                return this.numerator * other.denominator / gcd(this.denominator, other.denominator);
            };
            var operations = [
                ['equals', '=='],
                ['lessThan', '<'],
                ['lessThanOrEquals', '<='],
                ['greaterThanOrEquals', '>=']
            ];
            var self = this;

            operations.forEach(function (operation, pos) {
                self[operation[0]] = spec(operation[1]);
            });
            this.reduce2 = function (other) {
                var m = other.denominator / gcd(this.denominator, other.denominator);
                return retional(this.numerator * m, this.denominator * m, true);
            };

            this.add = function (other) {
                var left = this.reduce2(other);
                var right = other.reduce2(this);
                return retional(left.numerator + right.numerator, left.denominator);
            };
            this.sub = function (other) {
                var left = this.reduce2(other);
                var right = other.reduce2(this);
                return retional(left.numerator - right.numerator, left.denominator);
            };
            this.toString = function () {
                return [this.numerator, this.denominator].join('/');
            };
            !keep && this.simplify();
        }
        function retional(numerator, denominator, keep) {
            return new Retional(numerator, denominator, keep);
        }
    </script>
    <script type="text/javascript">
        module('Rational Arithmetic');
        test('gcd', function () {
            equal(gcd(5, 0), 5);
            equal(gcd(0, 5), 5);
            equal(gcd(1, 5), 1);
            equal(gcd(4, 6), 2);
        });
        test('equality', function () {
            ok(retional(3, 5).equals(retional(3, 5)));
            ok(!retional(1, 5).equals(retional(3, 5)));
            ok(!retional(3, 7).equals(retional(3, 5)));
        });
        test('simplify', function () {
            ok(retional(1, 3).equals(retional(1, 3)));
            ok(retional(5, 10).equals(retional(1, 2)));
        });
        test('negative', function () {
            ok(retional(-1, 3).equals(retional(-1, 3)));
            ok(retional(1, -3).equals(retional(-1, 3)));
        });
        test('toString', function () {
            equal(retional(1, 3).toString(), '1/3');
            equal(retional(-2, 5).toString(), '-2/5');
        });
        test('lessThan', function () {
            ok(retional(1, 3).lessThan(retional(2, 3)));
            ok(!retional(1, 3).lessThan(retional(1, 3)));
            ok(!retional(3, 5).lessThan(retional(1, 5)));
            ok(retional(3, 10).lessThan(retional(1, 2)));
            ok(!retional(1, 2).lessThan(retional(3, 10)));
        });
        test('lessThanOrEquals', function () {
            ok(retional(1, 3).lessThanOrEquals(retional(2, 3)));
            ok(retional(1, 3).lessThanOrEquals(retional(1, 3)));
            ok(!retional(3, 5).lessThanOrEquals(retional(1, 5)));
        });
        test('greaterThanOrEquals', function () {
            ok(!retional(1, 3).greaterThanOrEquals(retional(2, 3)));
            ok(retional(1, 3).greaterThanOrEquals(retional(1, 3)));
            ok(retional(3, 5).greaterThanOrEquals(retional(1, 5)));
        });

        test('add', function () {
            ok(retional(1, 5).add(retional(2, 5)).equals(retional(3, 5)));
            ok(retional(1, 5).add(retional(4, 5)).equals(retional(1, 1)));
        });

        test('reduce before add', function () {
            ok(retional(1, 2).add(retional(1, 4)).equals(retional(3, 4)));
            ok(retional(1, 4).add(retional(1, 2)).equals(retional(3, 4)));
        });
        test('sub', function () {
            ok(retional(3, 5).sub(retional(2, 5)).equals(retional(1, 5)));
            ok(retional(2, 5).sub(retional(3, 5)).equals(retional(-1, 5)));
        });
        test('reduce before sub', function () {
            ok(retional(1, 2).sub(retional(1, 4)).equals(retional(1, 4)));
            ok(retional(1, 4).sub(retional(1, 2)).equals(retional(-1, 4)));
        });

    </script>
</head>
<body>
<div id="qunit"></div>
</body>
</html>